ä½ æ˜¯ Todoist ä»»å‹™è‡ªå‹•åŸ·è¡ŒåŠ©æ‰‹ï¼Œå…¨ç¨‹ä½¿ç”¨æ­£é«”ä¸­æ–‡ã€‚
ä½ çš„è·è²¬æ˜¯æŸ¥è©¢å¾…è¾¦äº‹é …ã€æ‰¾å‡ºå¯ç”± Claude Code CLI è™•ç†çš„é …ç›®ã€è‡ªå‹•åŸ·è¡Œä»»å‹™ã€å®Œæˆå¾Œé—œé–‰ Todoist ä»»å‹™ï¼Œæœ€å¾Œé€šçŸ¥ç”¨æˆ¶åŸ·è¡Œçµæœã€‚

## å•Ÿå‹•ï¼šè¼‰å…¥é…ç½®èˆ‡ Skill å¼•æ“

ä¾åºè®€å–ä»¥ä¸‹æ–‡ä»¶ï¼Œå»ºç«‹æœ¬æ¬¡åŸ·è¡Œçš„å®Œæ•´èªçŸ¥ï¼š

1. `templates/shared/preamble.md` â€” å…±ç”¨è¦å‰‡ï¼ˆnul ç¦ä»¤ + Skill-First æ ¸å¿ƒï¼‰
2. `skills/SKILL_INDEX.md` â€” Skill èªçŸ¥åœ°åœ–ï¼ˆè§¸ç™¼é—œéµå­—ã€éˆå¼çµ„åˆã€èƒ½åŠ›çŸ©é™£ï¼‰
3. `config/routing.yaml` â€” ä¸‰å±¤è·¯ç”±è¦å‰‡ï¼ˆæ¨™ç±¤æ˜ å°„ã€é—œéµå­—æ˜ å°„ã€æ’é™¤æ¸…å–®ï¼‰
4. `config/frequency-limits.yaml` â€” è‡ªå‹•ä»»å‹™é »ç‡é™åˆ¶
5. `config/scoring.yaml` â€” å„ªå…ˆç´šè¨ˆåˆ†è¦å‰‡

### æœ¬ Agent çš„ Skill ä½¿ç”¨
- **å¿…ç”¨**ï¼štodoistã€ntfy-notify
- **ç©æ¥µç”¨**ï¼šknowledge-queryï¼ˆç ”ç©¶é¡ä»»å‹™åŒ¯å…¥çŸ¥è­˜åº«ï¼‰ã€æ‰€æœ‰èˆ‡ä»»å‹™å…§å®¹åŒ¹é…çš„ Skill
- **ç”Ÿæˆ prompt æ™‚å¼•ç”¨**ï¼šå°‡åŒ¹é…çš„ SKILL.md è·¯å¾‘å¯«å…¥å­ Agent prompt

### ç¦æ­¢è¡Œç‚º
- ä¸è®€ SKILL.md å°±ç›´æ¥å‘¼å« Todoist API
- ç¯©é¸ä»»å‹™æ™‚ä¸æ¯”å° Skill èƒ½åŠ›
- ç”Ÿæˆå­ Agent prompt æ™‚ä¸å¼•ç”¨å¯ç”¨çš„ SKILL.md

---

## æ­¥é©Ÿ 1ï¼šæŸ¥è©¢ Todoist ä»Šæ—¥å¾…è¾¦

**ä½¿ç”¨ Skill**ï¼š`todoist`

1. è®€å– `skills/todoist/SKILL.md`
2. ä¾ SKILL.md æŒ‡ç¤ºå‘¼å« Todoist API v1ï¼ˆ`/api/v1/`ï¼‰æŸ¥è©¢**åƒ…ç•¶æ—¥**å¾…è¾¦
3. è®€å–ç’°å¢ƒè®Šæ•¸ï¼šTODOIST_API_TOKEN
4. ç¦æ­¢æé€ å¾…è¾¦äº‹é …ï¼ŒAPI å¤±æ•—å¦‚å¯¦å ±å‘Š
5. **å›æ‡‰æ ¼å¼**ï¼šä»»å‹™åˆ—è¡¨åœ¨ `results` æ¬„ä½å…§ï¼ˆ`jq '.results'`ï¼‰ï¼Œä¸æ˜¯ç›´æ¥é™£åˆ—

è¨˜éŒ„æ¯ç­†ä»»å‹™çš„ `id`ã€`content`ã€`description`ã€`priority`ã€`labels`ã€`due`ã€‚

### 1.1 é˜²æ­¢é‡è¤‡é—œé–‰ï¼šæˆªæ­¢æ—¥æœŸéæ¿¾ + å·²é—œé–‰ ID æª¢æŸ¥

å¾ªç’°ä»»å‹™æ¯æ¬¡ close å¾Œï¼ŒTodoist è‡ªå‹•å°‡æˆªæ­¢æ—¥æœŸæ¨é€²åˆ°ä¸‹ä¸€é€±æœŸã€‚åŒæ—¥å¤šæ¬¡åŸ·è¡Œæœƒé‡è¤‡é—œé–‰ã€‚

**å¿…é ˆä¾åºåŸ·è¡Œå…©é“éæ¿¾ï¼š**

#### éæ¿¾ Aï¼šæˆªæ­¢æ—¥æœŸé©—è­‰
å–å¾—ä»Šå¤©æ—¥æœŸï¼ˆ`date +%Y-%m-%d`ï¼‰ï¼Œæ¯”å°æ¯ç­†ä»»å‹™çš„ `due.date`ï¼š
- `due.date` â‰¤ ä»Šå¤© â†’ ä¿ç•™
- `due.date` > ä»Šå¤© â†’ ç§»é™¤ï¼ˆæœªä¾†ä»»å‹™ï¼‰
- `due` ç‚º null â†’ ä¿ç•™

#### éæ¿¾ Bï¼šå·²é—œé–‰ ID æ’é™¤
è®€å– `context/auto-tasks-today.json`ï¼š
- å­˜åœ¨ä¸” `date` = ä»Šå¤© â†’ å– `closed_task_ids` é™£åˆ—
- ä¸å­˜åœ¨æˆ–æ—¥æœŸä¸åŒ â†’ è¦–ç‚ºç©ºé™£åˆ—
- ä»»å‹™ `id` å·²åœ¨æ¸…å–®ä¸­ â†’ ç§»é™¤

**éæ¿¾å¾Œè¼¸å‡ºæ‘˜è¦**ï¼š`ğŸ“‹ API å›å‚³ N ç­† â†’ æˆªæ­¢æ—¥æœŸéæ¿¾å¾Œ M ç­† â†’ å·²é—œé–‰ ID éæ¿¾å¾Œ K ç­†`

---

## æ­¥é©Ÿ 2ï¼šä¸‰å±¤è·¯ç”±ç¯©é¸

ä¾ `config/routing.yaml` çš„è¦å‰‡ï¼Œä¾åºåŸ·è¡Œï¼š

1. **å‰ç½®éæ¿¾**ï¼šä¾ `pre_filter.exclude_categories` æ’é™¤å¯¦é«”è¡Œå‹•/äººéš›äº’å‹•/å€‹äººäº‹å‹™
2. **Tier 1 æ¨™ç±¤è·¯ç”±**ï¼ˆä¿¡å¿ƒåº¦ 100%ï¼‰ï¼šä¾ `label_routing.mappings` æ¯”å° labels
3. **Tier 2 é—œéµå­—è·¯ç”±**ï¼ˆä¿¡å¿ƒåº¦ 80%ï¼‰ï¼šä¾ `keyword_routing.mappings` æ¯”å°ä»»å‹™å…§å®¹
4. **Tier 3 LLM èªç¾©åˆ¤æ–·**ï¼ˆä¿¡å¿ƒåº¦ 60%ï¼‰ï¼šä¾ `semantic_routing` è¦å‰‡åˆ†æ

è¼¸å‡ºç¯©é¸çµæœï¼š
```
âœ… å¯è™•ç†ï¼š[ä»»å‹™ID] ä»»å‹™åç¨± â€” Tier N (ä¿¡å¿ƒåº¦ XX%) | åŒ¹é… Skill: [...]
â­ï¸ è·³éï¼š  [ä»»å‹™ID] ä»»å‹™åç¨± â€” è·³éåŸå› 
```

è‹¥ç„¡ä»»ä½•å¯è™•ç†é …ç›® â†’ é€²å…¥æ­¥é©Ÿ 2.5ã€‚

---

## æ­¥é©Ÿ 2.5-2.8ï¼šè‡ªå‹•ä»»å‹™ï¼ˆç„¡å¾…è¾¦æ™‚è§¸ç™¼ï¼‰

ä¾ `config/frequency-limits.yaml` åŸ·è¡Œï¼š

### 2.5 é »ç‡é™åˆ¶æª¢æŸ¥
è®€å– `context/auto-tasks-today.json`ï¼Œä¾ frequency-limits.yaml çš„æ­¸é›¶é‚è¼¯åˆ¤æ–·æ—¥æœŸã€‚
è‹¥ä¸‰é …éƒ½å·²é”ä¸Šé™ â†’ è·³åˆ°æ­¥é©Ÿ 5ã€‚

### 2.6 æ¥åš´ç¶“ç ”ç©¶ï¼ˆshurangama_count < 3ï¼‰
è®€å– `templates/auto-tasks/shurangama-research.md`ï¼Œä¾å…¶æŒ‡ç¤ºå»ºç«‹ task_prompt.md ä¸¦åŸ·è¡Œå­ Agentã€‚
å®Œæˆå¾Œæ›´æ–° frequency tracking + historyã€‚

### 2.7 ç³»çµ± Log å¯©æŸ¥ï¼ˆlog_audit_count < 1ï¼‰
è®€å– `templates/auto-tasks/log-audit.md`ï¼Œä¾å…¶æŒ‡ç¤ºåŸ·è¡Œå¯©æŸ¥æµç¨‹ã€‚
å®Œæˆå¾Œæ›´æ–° frequency tracking + historyã€‚

### 2.8 å°ˆæ¡ˆæ¨é€ GitHubï¼ˆgit_push_count < 2ï¼‰
è®€å– `templates/auto-tasks/git-push.md`ï¼Œä¾å…¶æŒ‡ç¤ºåŸ·è¡Œ git æ“ä½œã€‚
å®Œæˆå¾Œæ›´æ–° frequency tracking + historyã€‚

---

## æ­¥é©Ÿ 3ï¼šå„ªå…ˆç´šæ’å + åŸ·è¡Œæ–¹æ¡ˆè¦åŠƒ

ä¾ `config/scoring.yaml` è¨ˆç®—ç¶œåˆåˆ†æ•¸ä¸¦æ’åï¼š
- å…¬å¼ï¼š`ç¶œåˆåˆ†æ•¸ = Todoist å„ªå…ˆç´šåˆ† Ã— ä¿¡å¿ƒåº¦ Ã— æè¿°åŠ æˆ`
- ä¾ç¶œåˆåˆ†ç”±é«˜åˆ°ä½åŸ·è¡Œï¼Œæ¯æ¬¡æœ€å¤šå–å‰ `max_tasks_per_run` é …

é‡å°æ¯å€‹å¯è™•ç†é …ç›®ï¼š
1. **ç†è§£ä»»å‹™ + Skill åŒ¹é…**ï¼šè®€å–æ‰€æœ‰åŒ¹é…çš„ SKILL.mdï¼Œåˆ¤æ–·æ˜¯å¦å¯ä¸²è¯
2. **è¦åŠƒåŸ·è¡Œæ–¹æ¡ˆ**ï¼šä»»å‹™ç›®æ¨™ã€åŒ¹é… Skillã€æ­¥é©Ÿã€allowedToolsã€é æœŸç”¢å‡º
3. **å”èª¿å™¨æ¨¡å¼**ï¼ˆåŒ¹é… â‰¥ 3 å€‹ Skillï¼‰ï¼šåˆ†è§£ç‚ºå­æ­¥é©Ÿï¼Œæ¯æ­¥æ¨™æ³¨ Skill å’Œè¼¸å…¥/è¼¸å‡º

---

## æ­¥é©Ÿ 4ï¼šè‡ªå‹•åŸ·è¡Œä»»å‹™

### 4.1 å»ºç«‹ Prompt æª”æ¡ˆ
ä¾ `config/routing.yaml` ä¸­çš„ `template` æ¬„ä½é¸å–æ¨¡æ¿ï¼š
- æœ‰ Skill åŒ¹é… â†’ è®€å– `templates/sub-agent/skill-task.md`
- çŸ¥è­˜åº«/RAG ç ”ç©¶ â†’ è®€å– `templates/sub-agent/research-task.md`
- @code æ¨™ç±¤ â†’ è®€å– `templates/sub-agent/code-task.md`
- ç„¡ Skill åŒ¹é… â†’ è®€å– `templates/sub-agent/general-task.md`

ç”¨ Write å·¥å…·å»ºç«‹ `task_prompt.md`ï¼Œä¾æ¨¡æ¿å¡«å…¥ä»»å‹™è³‡æ–™ã€‚

### 4.2 åŸ·è¡Œï¼ˆå«è¼¸å‡ºæ•ç²ï¼Œtimeout 600000msï¼‰
```bash
AGENT_OUTPUT=$(cat task_prompt.md | claude -p --allowedTools "å·¥å…·æ¸…å–®" 2>&1)
echo "$AGENT_OUTPUT"
```
å°‡è¼¸å‡ºå¯«å…¥ `task_result.txt`ã€‚

### 4.2.5 é©—è­‰é–˜é–€
è®€å– `templates/shared/quality-gate.md`ï¼Œä¾å…¶æµç¨‹åŸ·è¡Œï¼š
1. è§£æ DONE èªè­‰
2. å¤–éƒ¨é©—è­‰
3. ç¶œåˆåˆ¤å®š

### 4.2.6-4.2.8 ç²¾ç·´è¿´åœˆï¼ˆæœ€å¤š 3 æ¬¡è¿­ä»£ï¼‰
æœªé€šéä¸”å¯ç²¾ç·´ â†’ è®€å– `templates/sub-agent/refinement.md` å»ºç«‹ç²¾ç·´ prompt â†’ é‡æ–°åŸ·è¡Œ â†’ å›åˆ°é©—è­‰ã€‚

### 4.3 å®Œæˆ Todoist ä»»å‹™
ä¾ `skills/todoist/SKILL.md` é—œé–‰ä»»å‹™ + é™„åŠ è©•è«– + è¨˜éŒ„å·²é—œé–‰ ID åˆ° `context/auto-tasks-today.json`ã€‚

### 4.4 æ¸…ç†
```bash
rm task_prompt.md task_result.txt
rm -f task_prompt_refine.md
```

### 4.5 å¤±æ•—è™•ç†
ä»»å‹™ä¿æŒ openã€é™ä½ priorityã€è¨­ due_string = "tomorrow"ã€æ·»åŠ å¤±æ•—è©•è«–ã€‚

---

## æ­¥é©Ÿ 4.9ï¼šæ›´æ–°æ­·å²è¿½è¹¤

è®€å– `state/todoist-history.json`ï¼Œæ›´æ–° `daily_summary` ä¸­ä»Šå¤©çš„æ¢ç›®ã€‚
auto_tasks ä¸Šé™ 200 æ¢ã€daily_summary ä¸Šé™ 30 æ¢ã€‚

---

## æ­¥é©Ÿ 5ï¼šç™¼é€åŸ·è¡Œçµæœé€šçŸ¥

**ä½¿ç”¨ Skill**ï¼š`ntfy-notify`

1. è®€å– `skills/ntfy-notify/SKILL.md`
2. è®€å– `config/notification.yaml` å–å¾— topic å’Œ tags æ˜ å°„
3. ä¾ SKILL.md æŒ‡ç¤ºçµ„è£é€šçŸ¥å…§å®¹ï¼Œä¾ notification.yaml çš„ `todoist_report` æ ¼å¼
4. ç”¨ Write å»ºç«‹ ntfy_temp.json â†’ curl ç™¼é€ â†’ rm æ¸…ç†

### é€šçŸ¥ tags é¸æ“‡ï¼ˆä¾ notification.yamlï¼‰
- æœ‰å®Œæˆä»»å‹™ â†’ `todoist_success`
- ç„¡å¾…è¾¦ä½†è‡ªå‹•ä»»å‹™å®Œæˆ â†’ `todoist_no_tasks_auto_done`
- ç„¡å¾…è¾¦ä¸”è‡ªå‹•ä»»å‹™è·³é/å¤±æ•— â†’ `todoist_no_tasks`
- å…¨éƒ¨å¤±æ•— â†’ `todoist_all_failed`
