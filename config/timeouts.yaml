# config/timeouts.yaml
# 集中管理所有 timeout 值（秒）
# 修改此文件可調整各階段超時，不需動 .ps1 腳本
version: 1

# 每日摘要 - 團隊模式 (run-agent-team.ps1)
daily_digest_team:
  phase1_timeout: 300       # Phase 1: 並行資料擷取
  phase2_timeout: 420       # Phase 2: 摘要組裝
  phase2_max_retries: 1     # Phase 2 重試次數
  retry_base_interval: 60   # 重試基礎間隔（指數退避）
  retry_max_interval: 300   # 重試最大間隔
  retry_jitter_max: 15      # 重試隨機抖動上限

# 每日摘要 - 單一模式 (run-agent.ps1)
daily_digest_single:
  timeout: 900              # 總超時
  max_retries: 1            # 重試次數
  retry_interval: 120       # 重試間隔

# Todoist 任務 - 團隊模式 (run-todoist-agent-team.ps1)
todoist_team:
  phase1_timeout: 420        # Phase 1: 查詢+路由+規劃+寫入 task prompt 檔案（300s 偶爾不足）
  phase1_max_retries: 1      # Phase 1 重試次數（降為 1，避免過長等待）
  phase1_retry_delay_base: 30  # Phase 1 重試間隔基數（秒）
  phase1_retry_delay_jitter: 10  # Phase 1 隨機抖動
  phase3_timeout: 180        # Phase 3: 組裝+通知
  phase3_max_retries: 1      # Phase 3 重試次數
  phase3_retry_base: 60      # Phase 3 重試基礎間隔
  phase3_retry_max: 300      # Phase 3 重試最大間隔
  # Phase 2 動態 timeout（按任務類型）
  phase2_timeout_by_type:
    research: 600   # 研究任務（10 分鐘）
    code: 900       # 程式任務（15 分鐘）
    skill: 300      # Skill 任務（5 分鐘）
    general: 300    # 一般任務（5 分鐘）
    auto: 600       # 自動任務（10 分鐘）
    gitpush: 360    # Git 推送（6 分鐘）
  # Phase 2 動態 timeout（按 auto-task key，優先級高於 phase2_timeout_by_type）
  phase2_timeout_by_task:
    creative_game_optimize: 900 # sync-games.ps1 npm build 最長 ~15 min
    log_audit: 720              # 讀 10+ log + 分析修正 + KB 匯入
    qa_optimize: 720            # WebSearch CVE + Grep 掃描 + 程式碼修改
    ai_deep_research: 720       # 4 階段 WebFetch
    tech_research: 2000         # WebSearch×3 + WebFetch×3 + KB 匯入，2026-02-26 超時紀錄

# Todoist 任務 - 單一模式 (run-todoist-agent.ps1)
todoist_single:
  timeout: 2100             # 總超時

# Gmail Agent (run-gmail-agent.ps1)
gmail:
  timeout: 600              # 總超時
  max_retries: 1            # 重試次數
  retry_interval: 120       # 重試間隔

# 系統審查 - 團隊模式 (run-system-audit-team.ps1)
audit_team:
  phase1_timeout: 600       # Phase 1: 審查 Agent（10 分鐘）
  phase2_timeout: 1200      # Phase 2: 組裝+修正（20 分鐘）
  phase2_max_retries: 1     # Phase 2 重試次數

# HEARTBEAT.md 排程超時
scheduler:
  system_audit: 2400        # 00:40 系統審查
  daily_digest_am: 3600     # 08:00 摘要
  daily_digest_mid: 900     # 11:15 摘要
  daily_digest_pm: 3600     # 21:15 摘要
  todoist_single: 2400      # 整點 Todoist
  todoist_team: 3600        # 半點 Todoist（PT1H，含 creative-game 1020s + buffer）
