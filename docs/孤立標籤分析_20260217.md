# 孤立標籤分析與處理建議

**日期**：2026-02-17
**發現者**：方案 2（Routing 一致性檢查）
**總數**：11 個

## 孤立標籤清單

以下標籤在 `config/routing.yaml` 中有映射，但沒有對應的 Skill 宣稱它們為 triggers：

1. **Claude Code** (line 57) - 映射到程式開發，模板 code-task.md
2. **GitHub** (line 61) - 映射到程式開發，模板 code-task.md
3. **研究** (已在 label_routing.mappings)
4. **深度思維** (line 69 + task_type_labels line 36) - 映射到 deep-research + knowledge-query，模板 research-task.md
5. **知識庫** (line 73, modifier label)
6. **AI** (line 77) - 映射到 hackernews-ai-digest，模板 skill-task.md
7. **遊戲開發** (line 85) - 映射到 game-design，模板 game-task.md
8. **專案優化** (line 89) - 映射到程式開發，模板 code-task.md
9. **網站優化** (line 93) - 映射到程式開發，模板 code-task.md
10. **UI** (line 97) - 映射到程式開發，模板 code-task.md
11. **UI/UX** (line 101) - 映射到程式開發，模板 code-task.md
12. **Cloudflare** (line 105) - 映射到 game-design，模板 code-task.md
13. **邏輯思維** (line 109) - 映射到 deep-research + knowledge-query，模板 research-task.md

## 核心問題分析

**問題本質**：這些「孤立標籤」反映了設計上的差異：

- **routing.yaml 的標籤**：Todoist 任務分類標籤（用戶手動添加到任務上）
- **SKILL.md 的 triggers**：Skill 啟動關鍵字（用於內容匹配）

**兩者的關係**：
```
Todoist 任務標籤（如 "遊戲開發"）
  → routing.yaml 映射到 Skill（如 game-design）
  → Skill 的 triggers 用於內容匹配（如 "遊戲", "game"）
```

**例子**：
- 任務帶有「遊戲開發」標籤 → routing.yaml 路由到 game-design Skill
- game-design Skill 的 triggers 是「遊戲」、「game」、「遊戲設計」等
- 「遊戲開發」不需要在 triggers 中，因為它是任務標籤，不是內容關鍵字

## 處理建議

### 選項 1：接受現狀（推薦）⭐

**理由**：
- 這些標籤都是有效的路由標籤，有明確的映射邏輯
- Skill triggers 和 routing 標籤服務於不同目的
- 驗證警告實際上是誤報（設計差異，非配置錯誤）

**行動**：
- 無需修改 routing.yaml
- 無需修改 SKILL.md
- 修改 `hooks/validate_config.py` 的驗證邏輯，區分「路由標籤」和「Skill triggers」

**實施方案**：
```python
# 在 check_routing_consistency() 函數中
# 允許 routing.yaml 中的標籤沒有對應 Skill triggers（這是正常設計）
# 僅警告當：
# 1. routing.yaml 中的標籤沒有任何映射邏輯（真正的孤立）
# 2. Skill triggers 沒有在 routing.yaml 或 keyword_routing 中出現（真正的漂移）
```

### 選項 2：補全 Skill triggers（不推薦）

**做法**：在相關 Skills 的 triggers 中加入這些標籤

**問題**：
- game-design Skill 加入「遊戲開發」trigger → 內容匹配會過於寬鬆
- hackernews-ai-digest Skill 加入「AI」trigger → 幾乎所有 AI 相關內容都會命中
- 會導致 Skill triggers 過度擴張，失去精確性

### 選項 3：移除 routing.yaml 映射（不推薦）

**做法**：從 routing.yaml 刪除這些標籤

**問題**：
- 這些標籤都是實際使用的任務分類標籤
- 移除後無法路由對應任務
- 會破壞現有 Todoist 工作流

## 最終建議

**採用選項 1**，並實施以下改進：

### 1. 修改驗證邏輯

修改 `hooks/validate_config.py` 的 `check_routing_consistency()` 函數：

```python
def check_routing_consistency(skills_dir=None, config_dir=None):
    """檢查 SKILL.md triggers 與 routing.yaml 的一致性。

    修正後的邏輯：
    1. 檢查 Skill triggers 是否有對應的 routing 映射（防止 Skill 失效）
    2. **不**警告 routing.yaml 中的標籤沒有對應 Skill triggers（這是正常設計）

    Returns:
        (errors, warnings) — 各為字串 list。
    """
    # ... 現有代碼 ...

    # 4. 檢查：每個 trigger 是否在 routing.yaml 中有對應映射
    missing_in_routing = []
    for skill_name, triggers in skill_triggers.items():
        for trigger in triggers:
            if trigger not in routing_labels and trigger not in keyword_labels:
                missing_in_routing.append(f"{skill_name} 的 trigger '{trigger}' 未在 routing.yaml 中定義")

    # 5. **移除**反向檢查（routing.yaml 中的標籤是否被任何 Skill 宣稱）
    # 理由：routing 標籤和 Skill triggers 服務於不同目的，不需要一一對應

    # 6. 分類結果
    if missing_in_routing:
        warnings.extend(missing_in_routing)

    return errors, warnings
```

### 2. 更新文件

在 `config/routing.yaml` 頂部加入註解：

```yaml
# config/routing.yaml
# Todoist 任務三層路由規則
# 修改此文件可調整任務篩選和 Skill 匹配，不需碰 prompt

version: 2

# 設計說明：
# - routing.yaml 中的標籤是 Todoist 任務分類標籤（用戶手動添加）
# - SKILL.md 中的 triggers 是 Skill 啟動關鍵字（用於內容匹配）
# - 兩者服務於不同目的，不需要一一對應
# - 驗證工具僅檢查 Skill triggers 是否有路由映射，不檢查反向
```

### 3. 驗證修改後的效果

執行驗證後應該僅看到真正的問題（如有 Skill triggers 沒有路由映射）：

```bash
python hooks/validate_config.py --check-routing
```

**預期輸出**：
```
✅ 全部 14 項檢查通過（13 個配置檔 + Routing 一致性）
```

（不再有 11 個「孤立標籤」警告）

## 結論

這 11 個「孤立標籤」實際上是正常設計的一部分，反映了 routing 標籤和 Skill triggers 的不同用途。透過修改驗證邏輯，可以消除誤報，同時保留真正有價值的檢查（Skill triggers 是否有路由映射）。

---

**作者**：Claude Sonnet 4.5
**參考**：優化方案實施報告_完整版_20260217.md（方案 2）
