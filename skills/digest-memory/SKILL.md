---
name: digest-memory
version: "1.0.0"
description: |
  æ‘˜è¦è¨˜æ†¶æŒä¹…åŒ–ã€‚è·¨æ¬¡è¿½è¹¤é€£çºŒå¤©æ•¸ã€å¾…è¾¦çµ±è¨ˆã€ç¿’æ…£/å­¸ç¿’é€£çºŒå¤©æ•¸ã€‚
  Use when: è¨˜æ†¶ã€é€£çºŒå¤©æ•¸ã€ä¸Šæ¬¡åŸ·è¡Œã€è·¨æ¬¡è¿½è¹¤ã€‚
allowed-tools: Read, Write
triggers:
  - "è¨˜æ†¶"
  - "é€£çºŒå¤©æ•¸"
  - "ä¸Šæ¬¡åŸ·è¡Œ"
  - "è·¨æ¬¡è¿½è¹¤"
---

# Digest Memory Skill - æ‘˜è¦è¨˜æ†¶æŒä¹…åŒ–

## ç”¨é€”
åœ¨æ¯æ—¥æ‘˜è¦ Agent åŸ·è¡Œä¹‹é–“ä¿æŒä¸Šä¸‹æ–‡è¨˜æ†¶ï¼Œå¯¦ç¾è·¨æ¬¡è¿½è¹¤ã€‚

## è¨˜æ†¶æª”æ¡ˆä½ç½®
`context/digest-memory.json`

## è®€å–è¨˜æ†¶ï¼ˆAgent å•Ÿå‹•æ™‚ï¼‰

ç”¨ Read å·¥å…·è®€å– `context/digest-memory.json`ã€‚è‹¥æª”æ¡ˆä¸å­˜åœ¨ä»£è¡¨é¦–æ¬¡åŸ·è¡Œï¼Œè·³éå³å¯ã€‚

è¨˜æ†¶æª”æ¡ˆæ ¼å¼ï¼š
```json
{
  "schema_version": 2,
  "last_modified_by": "agent",
  "last_run": "2026-02-11T08:00:00+08:00",
  "last_run_status": "success",
  "run_count": 42,
  "todoist": {
    "total_tasks": 5,
    "completed_count": 3,
    "pending_items": ["æœªå®Œæˆçš„ä»»å‹™åç¨±"]
  },
  "habits": {
    "streak_days": 14,
    "last_topic": "ç’°å¢ƒè¨­è¨ˆ",
    "topics_history": ["èº«ä»½èªåŒ", "ç¿’æ…£å †ç–Š", "ç’°å¢ƒè¨­è¨ˆ"]
  },
  "learning": {
    "streak_days": 14,
    "last_topic": "é–“éš”é‡è¤‡",
    "topics_history": ["è²»æ›¼æŠ€å·§", "åˆ»æ„ç·´ç¿’", "é–“éš”é‡è¤‡"]
  },
  "skill_usage": {
    "total_skills": 12,
    "used_skills": 10,
    "cache_hits": 2,
    "api_calls": 3,
    "cache_degraded": 0,
    "knowledge_imports": 0
  },
  "knowledge": {
    "total_notes": 42,
    "imports_today": 0,
    "top_tags": ["æ¥åš´ç¶“", "AIå‹•æ…‹", "ç³»çµ±å¯©æŸ¥"]
  },
  "digest_summary": "æ˜¨æ—¥ 5 é …å¾…è¾¦å®Œæˆ 3 é …ï¼Œå±æ±æ–°è 2 å‰‡ï¼ŒAI å‹•æ…‹ 3 å‰‡"
}
```

### Schema ç‰ˆæœ¬èªªæ˜
- `schema_version`ï¼šç›®å‰ç‚º 2ã€‚è®€å–æ™‚è‹¥ç¼ºå°‘æ­¤æ¬„ä½ï¼Œè¦–ç‚º v1ï¼ˆå‘å¾Œç›¸å®¹ï¼‰
- `last_modified_by`ï¼šå¯«å…¥è€…æ¨™è¨˜ï¼ˆ"agent" æˆ– "script"ï¼‰ï¼Œä¾¿æ–¼é™¤éŒ¯è¿½è¹¤

## ä½¿ç”¨è¨˜æ†¶ç”¢ç”Ÿæ‘˜è¦é–‹é ­

è‹¥è¨˜æ†¶å­˜åœ¨ï¼Œåœ¨æ‘˜è¦æœ€ä¸Šæ–¹åŠ å…¥ã€Œé€£çºŒå ±åˆ°ã€å€å¡Šï¼š
```
ğŸ”„ é€£çºŒå ±åˆ°ç¬¬ N å¤©
- æ˜¨æ—¥å¾…è¾¦ï¼šå®Œæˆ M/N é …ï¼ˆæœªå®Œæˆï¼šXXXï¼‰
- ç¿’æ…£æç¤ºé€£çºŒ N å¤©
- å­¸ç¿’æŠ€å·§é€£çºŒ N å¤©
```

## å¯«å…¥è¨˜æ†¶ï¼ˆAgent çµæŸå‰ï¼Œntfy é€šçŸ¥ä¹‹å‰ï¼‰

æ¯æ¬¡åŸ·è¡ŒçµæŸæ™‚ï¼Œç”¨ Write å·¥å…·å¯«å…¥æ›´æ–°å¾Œçš„ `context/digest-memory.json`ã€‚

æ›´æ–°è¦å‰‡ï¼š
1. `last_run`ï¼šç•¶å‰æ™‚é–“ï¼ˆISO 8601 æ ¼å¼ï¼‰
2. `last_run_status`ï¼šæ•´é«”åŸ·è¡Œç‹€æ…‹ï¼ˆsuccess / partial / failedï¼‰
3. `run_count`ï¼šå‰æ¬¡å€¼ +1ï¼ˆé¦–æ¬¡ç‚º 1ï¼‰
4. `todoist`ï¼šæœ¬æ¬¡æŸ¥è©¢åˆ°çš„å¾…è¾¦çµ±è¨ˆ
5. `habits.streak_days`ï¼šè‹¥æ˜¨æ—¥æœ‰åŸ·è¡Œï¼ˆlast_run åœ¨ 24-48 å°æ™‚å…§ï¼‰ï¼Œ+1ï¼›å¦å‰‡é‡ç½®ç‚º 1
6. `habits.last_topic`ï¼šæœ¬æ¬¡ä½¿ç”¨çš„ç¿’æ…£æç¤ºä¸»é¡Œ
7. `habits.topics_history`ï¼šä¿ç•™æœ€è¿‘ 7 ç­†
8. `learning`ï¼šåŒä¸Šé‚è¼¯
9. `digest_summary`ï¼šæœ¬æ¬¡æ‘˜è¦çš„ä¸€å¥è©±ç¸½çµ
10. `skill_usage`ï¼šæœ¬æ¬¡ Skill ä½¿ç”¨çµ±è¨ˆ
    - `total_skills`ï¼šå°ˆæ¡ˆå®šç¾©çš„ Skill ç¸½æ•¸ï¼ˆç›®å‰å›ºå®š 12ï¼‰
    - `used_skills`ï¼šæœ¬æ¬¡å¯¦éš›ä½¿ç”¨çš„ Skill æ•¸é‡
    - `cache_hits`ï¼šå¿«å–å‘½ä¸­æ¬¡æ•¸ï¼ˆå¾ api-cache è¿½è¹¤å–å¾—ï¼‰
    - `api_calls`ï¼šAPI å¯¦éš›å‘¼å«æ¬¡æ•¸
    - `cache_degraded`ï¼šé™ç´šä½¿ç”¨éæœŸå¿«å–æ¬¡æ•¸ï¼ˆæ–°å¢æ¬„ä½ï¼‰
    - `knowledge_imports`ï¼šæœ¬æ¬¡åŒ¯å…¥çŸ¥è­˜åº«çš„ç­†è¨˜æ•¸
11. `knowledge`ï¼šçŸ¥è­˜åº«å¥åº·è³‡è¨Š
    - `total_notes`ï¼šå¾ `/api/stats` å–å¾—çš„ç­†è¨˜ç¸½æ•¸ï¼ˆæŸ¥è©¢å¤±æ•—å‰‡ä¿ç•™å‰æ¬¡å€¼ï¼‰
    - `imports_today`ï¼šæœ¬æ¬¡æ‘˜è¦åŒ¯å…¥çš„ç­†è¨˜æ•¸
    - `top_tags`ï¼šå¾ `/api/notes/tags` å–å¾—çš„å‰ 5 å¤§æ¨™ç±¤ï¼ˆæŸ¥è©¢å¤±æ•—å‰‡ä¿ç•™å‰æ¬¡å€¼ï¼‰
12. `trends`ï¼ˆå¯é¸ï¼Œv2 æ–°å¢ï¼‰ï¼šæœ€è¿‘ 7 å¤©è¶¨å‹¢è³‡æ–™ï¼Œæ¯å¤©ä¸€ç­†
13. `insights`ï¼ˆå¯é¸ï¼Œv2 æ–°å¢ï¼‰ï¼šAgent è‡ªå‹•æç…‰çš„è·¨å¤©è§€å¯Ÿ

### trends å€å¡Šæ ¼å¼ï¼ˆå¯é¸ï¼‰
```json
"trends": [
  {
    "date": "2026-02-13",
    "tasks_total": 6,
    "tasks_completed": 0,
    "skills_used": 11,
    "cache_hits": 2,
    "api_calls": 3,
    "cache_degraded": 0
  }
]
```
- ä¿ç•™æœ€è¿‘ 7 ç­†ï¼ˆè¶…éå‰‡ç§»é™¤æœ€èˆŠçš„ï¼‰
- æ¯æ¬¡åŸ·è¡Œåªæ›´æ–°ç•¶å¤©çš„è¨˜éŒ„ï¼ˆåŒæ—¥å¤šæ¬¡åŸ·è¡Œå‰‡è¦†è“‹ï¼‰

### insights å€å¡Šæ ¼å¼ï¼ˆå¯é¸ï¼‰
```json
"insights": [
  "HN å¿«å–å‘½ä¸­ç‡é€£çºŒ 3 å¤©åä½ï¼Œå»ºè­°æª¢æŸ¥ TTL è¨­å®š",
  "æ¥åš´ç¶“ç ”ç©¶å·²ç´¯è¨ˆ 15 ç¯‡ï¼Œå»ºè­°é–‹å§‹ç³»çµ±æ€§æ•´ç†"
]
```
- Agent åœ¨å¯«å…¥è¨˜æ†¶æ™‚ï¼Œè§€å¯Ÿ trends è³‡æ–™ï¼Œæç…‰ 1-2 å‰‡æ´å¯Ÿ
- ä¿ç•™æœ€è¿‘ 5 å‰‡ï¼ˆè¶…éå‰‡ç§»é™¤æœ€èˆŠçš„ï¼‰
- ç„¡ç‰¹åˆ¥ç™¼ç¾æ™‚å¯ç‚ºç©ºé™£åˆ—

## è¨ˆç®—é€£çºŒå¤©æ•¸çš„é‚è¼¯

ä»¥**æœ¬åœ°æ—¥æœŸ**ï¼ˆ+08:00 å°ç£æ™‚å€ï¼‰ç‚ºæº–ï¼š

```
è‹¥ last_run å­˜åœ¨ä¸” JSON å¯æ­£å¸¸è§£æï¼š
  last_date = last_run çš„æ—¥æœŸéƒ¨åˆ†ï¼ˆYYYY-MM-DDï¼‰
  today = ç•¶å‰æœ¬åœ°æ—¥æœŸ
  è‹¥ last_date == todayï¼šstreak ä¸è®Šï¼ˆåŒæ—¥é‡è¤‡åŸ·è¡Œï¼‰
  è‹¥ last_date == yesterdayï¼šstreak = å‰æ¬¡ streak + 1
  å¦å‰‡ï¼šstreak = 1ï¼ˆä¸­æ–·è¶…éä¸€å¤©ï¼‰
è‹¥ last_run ä¸å­˜åœ¨æˆ– JSON æå£ï¼š
  streak = 1ï¼ˆé‡ç½®ï¼‰
```

### é—œéµè¦å‰‡
- **åªæœ‰æˆåŠŸåŸ·è¡Œ**ï¼ˆ`last_run_status == "success"`ï¼‰æ‰è¨ˆå…¥é€£çºŒå¤©æ•¸
- **åŒæ—¥å¤šæ¬¡åŸ·è¡Œ**ä¸é‡è¤‡éå¢ï¼Œstreak ç¶­æŒä¸è®Š
- **JSON æå£**ï¼ˆè®€å–å¤±æ•—æˆ–æ ¼å¼éŒ¯èª¤ï¼‰â†’ é‡ç½® streak ç‚º 1ï¼Œè¨˜éŒ„è­¦å‘Š

## å¯«å…¥è¦å‰‡
- `schema_version`ï¼šå›ºå®šç‚º 2
- `last_modified_by`ï¼šå›ºå®šç‚º "agent"
- `last_run`ï¼šä½¿ç”¨ ISO 8601 å«æ™‚å€æ ¼å¼ï¼ˆå¦‚ `2026-02-13T16:57:00+08:00`ï¼‰

## æ³¨æ„äº‹é …
- ç”¨ Write å·¥å…·å»ºç«‹ JSON æª”æ¡ˆï¼Œç¢ºä¿ UTF-8 ç·¨ç¢¼
- JSON å…§å®¹ä¸è¦åŒ…å«æ§åˆ¶å­—å…ƒï¼Œæ›è¡Œç”¨ \n
- è¨˜æ†¶æª”æ¡ˆä¸éœ€è¦åˆªé™¤ï¼ŒæŒçºŒç´¯ç©
