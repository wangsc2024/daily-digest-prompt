# QA System å“è³ªèˆ‡å®‰å…¨å„ªåŒ– Prompt æ¨¡æ¿

> è§¸ç™¼æ¢ä»¶ï¼šTodoist ç„¡å¯è™•ç†é …ç›®ä¸” qa_optimize_count < 2
> ä¸» Agent ç”¨æ­¤æ¨¡æ¿å»ºç«‹ task_prompt.mdï¼Œé€é `claude -p` åŸ·è¡Œ

```
ä½ æ˜¯è³‡è¨Šå®‰å…¨èˆ‡è»Ÿé«”å“è³ªå·¥ç¨‹å¸«ï¼Œå…¨ç¨‹ä½¿ç”¨æ­£é«”ä¸­æ–‡ã€‚
éµå®ˆ `templates/shared/preamble.md` æ‰€æœ‰è¦å‰‡ï¼ˆSkill-First + nul ç¦ä»¤ï¼‰ã€‚

## å·¥ä½œç›®éŒ„
D:\Source\qa_system

## âš¡ Skill-First è¦å‰‡
å¿…é ˆå…ˆè®€å–ä»¥ä¸‹ SKILL.mdï¼š
- skills/SKILL_INDEX.md
- skills/knowledge-query/SKILL.md

## ä»»å‹™
ä»¥æœ€åš´æ ¼çš„è³‡è¨Šå®‰å…¨æ¨™æº–ï¼Œæ¼¸é€²å¼å„ªåŒ– QA System çš„å“è³ªèˆ‡å®‰å…¨æ€§ã€‚
æ¯æ¬¡åŸ·è¡Œå‰å¿…é ˆå›é¡§å‰æ¬¡å„ªåŒ–è¨˜éŒ„ï¼Œç¢ºèªå¾…è¾¦äº‹é …ï¼Œä»¥ä¹‹å‰æˆæœç‚ºåŸºç¤æŒçºŒæ”¹é€²ã€‚

## ç¬¬é›¶æ­¥ï¼šå›é¡§å‰æ¬¡å„ªåŒ–è¨˜éŒ„ï¼ˆå¿…åšï¼‰

### 0.1 æŸ¥è©¢çŸ¥è­˜åº«
```bash
curl -s -X POST "http://localhost:3000/api/search/hybrid" \
  -H "Content-Type: application/json" \
  -d '{"query": "QA System å„ªåŒ– å®‰å…¨ å“è³ª", "topK": 5}'
```

### 0.2 è®€å–å°ˆæ¡ˆå„ªåŒ–æ—¥èªŒ
è®€å– `D:\Source\qa_system\logs\optimization-history.jsonl`ï¼ˆè‹¥å­˜åœ¨ï¼‰ã€‚
å–æœ€è¿‘ 2 ç­†è¨˜éŒ„ï¼Œç¢ºèªï¼š
- å‰æ¬¡å„ªåŒ–äº†ä»€éº¼ï¼Ÿ â†’ æœ¬æ¬¡ä¸é‡è¤‡
- æœ‰ç„¡ remaining_issuesï¼Ÿ â†’ æœ¬æ¬¡å„ªå…ˆè™•ç†
- quality_score è¶¨å‹¢ï¼Ÿ â†’ ç¢ºèªæŒçºŒæ”¹å–„
- å‰æ¬¡æ–°å¢çš„å¾…è¾¦ï¼Ÿ â†’ æœ¬æ¬¡æ¥çºŒ

### 0.3 æ±ºå®šæœ¬æ¬¡å„ªåŒ–æ–¹å‘
æ ¹æ“šå‰æ¬¡è¨˜éŒ„é¸æ“‡æœ¬æ¬¡é‡é»ï¼ˆä¾å„ªå…ˆç´šæ’åºï¼‰ï¼š
1. **å‰æ¬¡å¾…è¾¦äº‹é …**ï¼ˆæœ€é«˜å„ªå…ˆï¼‰
2. **è³‡è¨Šå®‰å…¨æ¼æ´**ï¼ˆOWASP Top 10ï¼‰
3. **ç¨‹å¼ç¢¼å“è³ª**ï¼ˆlintã€type-checkã€code smellï¼‰
4. **æ¸¬è©¦è¦†è“‹ç‡**ï¼ˆè£œå…¨ç¼ºå¤±çš„æ¸¬è©¦ï¼‰
5. **æ¶æ§‹æ”¹å–„**ï¼ˆæ•ˆèƒ½ã€å¯ç¶­è­·æ€§ï¼‰

è¼¸å‡ºï¼šã€Œæœ¬æ¬¡å„ªåŒ–æ–¹å‘ï¼š[æ–¹å‘] â€” [ä¾æ“šï¼šå‰æ¬¡å¾…è¾¦/æ–°ç™¼ç¾/è¨ˆç•«æ’ç¨‹]ã€

## ç¬¬ä¸€æ­¥ï¼šå®‰å…¨æƒæï¼ˆæ¯æ¬¡å¿…åšï¼‰

### 1.1 éœæ…‹å®‰å…¨åˆ†æ
åœ¨ D:\Source\qa_system ç›®éŒ„ä¸‹åŸ·è¡Œï¼š

1. æœå°‹ç¡¬ç·¨ç¢¼å¯†é‘°ï¼š
   Grep æœå°‹ SECRET_KEY, PASSWORD, TOKEN, API_KEY ç­‰ï¼ˆæ’é™¤ .gitignore åˆ—å‡ºçš„æª”æ¡ˆï¼‰

2. æœå°‹ SQL æ³¨å…¥é¢¨éšªï¼š
   Grep æœå°‹ text(), execute(), raw SQL ç­‰æ¨¡å¼

3. æœå°‹ XSS é¢¨éšªï¼š
   Grep æœå°‹ |safe, innerHTML, document.write ç­‰æ¨¡å¼

4. æœå°‹ä¸å®‰å…¨çš„ CORSï¼š
   Grep æœå°‹ allow_origins, CORSMiddleware, "*"

5. æœå°‹ä¸å®‰å…¨çš„ Cookieï¼š
   Grep æœå°‹ httponly, secure, samesite è¨­å®š

6. æœå°‹ä¸å®‰å…¨çš„ JWTï¼š
   Grep æœå°‹ JWT é…ç½®ã€token éæœŸæ™‚é–“

### 1.2 ä¾è³´å®‰å…¨
è®€å– requirements.txtï¼Œç”¨ WebSearch æŸ¥è©¢å·²çŸ¥ CVEã€‚

### 1.3 å®‰å…¨è©•ä¼°
è¼¸å‡ºå®‰å…¨è©•ä¼°å ±å‘Šï¼š
| é¢¨éšªç­‰ç´š | é …ç›® | ç‹€æ…‹ | èªªæ˜ |
|---------|------|------|------|
| ğŸ”´ åš´é‡ | ... | å¾…ä¿®/å·²ä¿® | ... |
| ğŸŸ¡ ä¸­ç­‰ | ... | å¾…ä¿®/å·²ä¿® | ... |
| ğŸŸ¢ ä½é¢¨éšª | ... | æ­£å¸¸ | ... |

## ç¬¬äºŒæ­¥ï¼šå“è³ªæƒæ

### 2.1 ç¨‹å¼ç¢¼å“è³ª
1. è®€å–é—œéµæ¨¡çµ„ï¼ˆrouters/, models/, schemas/, dependencies.pyï¼‰
2. æª¢æŸ¥ï¼š
   - å‡½å¼éé•·ï¼ˆ>50 è¡Œï¼‰
   - é‡è¤‡ç¨‹å¼ç¢¼
   - æœªä½¿ç”¨çš„ import
   - ç•°å¸¸è™•ç†ä¸å®Œæ•´ï¼ˆè£¸ exceptï¼‰
   - å‹åˆ¥æ¨™æ³¨ç¼ºå¤±

### 2.2 æ¸¬è©¦è¦†è“‹
1. è®€å– tests/ ä¸‹æ‰€æœ‰æ¸¬è©¦æª”æ¡ˆ
2. æ¯”å° routers/ ä¸­çš„ç«¯é»ï¼Œåˆ—å‡ºæœªè¦†è“‹çš„ API
3. æª¢æŸ¥ conftest.py çš„ fixture æ˜¯å¦å®Œæ•´

## ç¬¬ä¸‰æ­¥ï¼šå¯¦æ–½ä¿®å¾©ï¼ˆåš´æ ¼é™åˆ¶ç¯„åœï¼‰

### ä¿®å¾©åŸå‰‡
- **æ¯æ¬¡åªä¿®å¾© 1-3 å€‹å…·é«”å•é¡Œ**ï¼Œä¸åšå…¨é¢é‡æ§‹
- **å®‰å…¨å•é¡Œå„ªå…ˆ**ï¼Œå“è³ªå•é¡Œå…¶æ¬¡
- **ä¿®æ”¹å‰å‚™ä»½**ï¼š`cp æª”æ¡ˆ æª”æ¡ˆ.bak`
- **ä¿®æ”¹å¾Œé©—è­‰**ï¼šèªæ³•æª¢æŸ¥ + åŠŸèƒ½é©—è­‰

### ä¿®å¾©å‰é©—å¯©ï¼ˆå¿…åšï¼‰
| # | é©—å¯©é …ç›® | é€šéæ¢ä»¶ |
|---|---------|---------|
| 1 | é‚è¼¯æ­£ç¢º | ä¿®æ”¹è§£æ±ºæ ¹å› ï¼Œéé®è”½ç—‡ç‹€ |
| 2 | å‰¯ä½œç”¨è©•ä¼° | ä¸å½±éŸ¿ç¾æœ‰åŠŸèƒ½ |
| 3 | å®‰å…¨åˆè¦ | ä¸å¼•å…¥æ–°çš„å®‰å…¨é¢¨éšª |
| 4 | å‘å¾Œç›¸å®¹ | è³‡æ–™åº« schema ç›¸å®¹ã€API å¥‘ç´„ä¸è®Š |

### ä¿®å¾©å¾Œé©—è­‰ï¼ˆå¿…åšï¼‰
1. Python èªæ³•æª¢æŸ¥ï¼š`python -m py_compile ä¿®æ”¹çš„æª”æ¡ˆ`
2. è‹¥ä¿®æ”¹äº†æ¸¬è©¦ç›¸é—œï¼š`cd D:\Source\qa_system && python -m pytest tests/ -x --tb=short`
3. è‹¥ä¿®æ”¹äº†è·¯ç”±/æ¨¡å‹ï¼šç¢ºèª import ç„¡èª¤
4. `git diff` ç¢ºèªä¿®æ”¹ç¯„åœæ­£ç¢º

è‹¥é©—è­‰å¤±æ•— â†’ é‚„åŸå‚™ä»½ â†’ è¨˜éŒ„ç‚º remaining_issue

## ç¬¬å››æ­¥ï¼šæ¸…ç†å‚™ä»½
é©—è­‰é€šéå¾Œï¼š`rm -f D:/Source/qa_system/*.bak D:/Source/qa_system/app/*.bak D:/Source/qa_system/app/routers/*.bak`

## ç¬¬äº”æ­¥ï¼šå¯«å…¥å„ªåŒ–æ—¥èªŒï¼ˆå¿…åšï¼‰

### 5.1 å¯«å…¥å°ˆæ¡ˆæ—¥èªŒ
ç¢ºä¿ç›®éŒ„å­˜åœ¨ï¼š`mkdir -p D:/Source/qa_system/logs`

ç”¨ Write å·¥å…·å°‡æœ¬æ¬¡å„ªåŒ–è¨˜éŒ„è¿½åŠ åˆ° `D:\Source\qa_system\logs\optimization-history.jsonl`ï¼š
æ ¼å¼ï¼ˆä¸€è¡Œ JSONï¼‰ï¼š
```json
{"ts":"ISO-8601","direction":"æœ¬æ¬¡å„ªåŒ–æ–¹å‘","based_on_previous":"å‰æ¬¡è¨˜éŒ„tsæˆ–null","security_findings":[{"level":"ğŸ”´/ğŸŸ¡/ğŸŸ¢","item":"æè¿°","status":"fixed/pending/noted"}],"quality_findings":[{"item":"æè¿°","status":"fixed/pending"}],"files_modified":["ä¿®æ”¹çš„æª”æ¡ˆæ¸…å–®"],"tests_run":true,"tests_passed":true,"remaining_issues":["ä¸‹æ¬¡éœ€è™•ç†çš„é …ç›®"],"quality_score":3,"self_assessment":"ä¸€å¥è©±è‡ªè©•"}
```

### 5.2 å¯«å…¥çŸ¥è­˜åº«
ä¾ knowledge-query SKILL.md åŒ¯å…¥å„ªåŒ–å ±å‘Šï¼š
- tags: ["QA System", "å®‰å…¨å„ªåŒ–", "å“è³ªæ”¹å–„", "æœ¬æ¬¡å…·é«”æ–¹å‘"]
- contentText: å®Œæ•´å„ªåŒ–å ±å‘Š Markdown
- source: "import"

## å“è³ªè‡ªè©•è¿´åœˆ
1. æ˜¯å¦å›é¡§äº†å‰æ¬¡å„ªåŒ–è¨˜éŒ„ï¼Ÿ
2. å®‰å…¨æƒææ˜¯å¦å®Œæ•´åŸ·è¡Œï¼Ÿ
3. ä¿®æ”¹æ˜¯å¦é€šéé©—è­‰ï¼Ÿ
4. å„ªåŒ–æ—¥èªŒæ˜¯å¦å·²å¯«å…¥ï¼Ÿ
5. çŸ¥è­˜åº«æ˜¯å¦å·²åŒ¯å…¥ï¼Ÿ
è‹¥ä»»ä½•é …ç›®æœªé€šéï¼šåˆ†æåŸå›  â†’ ä¿®æ­£ â†’ å†æª¢æŸ¥ï¼ˆæœ€å¤š 2 æ¬¡ï¼‰ã€‚

## è¼¸å‡º DONE èªè­‰
===DONE_CERT_BEGIN===
{"status":"DONE æˆ– PARTIAL æˆ– FAILED","checklist":{"primary_goal_met":true/false,"artifacts_produced":["ä¿®æ”¹çš„æª”æ¡ˆåˆ—è¡¨"],"tests_passed":true/false,"quality_score":1åˆ°5},"self_assessment":"ä¸€å¥è©±è‡ªè©•","remaining_issues":["ä¸‹æ¬¡å¾…è™•ç†"],"iteration_count":1}
===DONE_CERT_END===
```

## åŸ·è¡Œæ–¹å¼
```bash
cat task_prompt.md | claude -p --allowedTools "Read,Bash,Write,Edit,Glob,Grep,WebSearch,WebFetch"
```

## åŸ·è¡Œå¾Œæ›´æ–°
1. æ›´æ–° `context/auto-tasks-today.json`ï¼š`qa_optimize_count` + 1
2. å¯«å…¥ `state/todoist-history.json`ï¼šauto_tasks åŠ å…¥ type=qa_optimize è¨˜éŒ„
3. æ¸…ç†ï¼š`rm task_prompt.md`
